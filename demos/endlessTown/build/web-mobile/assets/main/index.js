System.register("chunks:///_virtual/itemMap.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./eventMgr.ts","./grid.ts","./item.ts","./appMain.ts"],(function(t){"use strict";var e,i,a,r,o,n,s,l,p,h,d,_,u,f,c,v;return{setters:[function(t){e=t.defineProperty,i=t.applyDecoratedDescriptor,a=t.inheritsLoose,r=t.assertThisInitialized,o=t.initializerDefineProperty},function(t){n=t.cclegacy,s=t._decorator,l=t.Node,p=t.Vec2,h=t.instantiate,d=t.Component},function(t){_=t.EventMgr},function(t){u=t.Grid},function(t){f=t.Item,c=t.FloorType},function(t){v=t.AppMain}],execute:function(){var I,g,M,y,x,m,T;n._RF.push({},"04c83WErXlPcrY7wzuU8bDT","itemMap",void 0);var P=s.ccclass,N=s.property;t("ItemMap",(I=P("ItemMap"),g=N({type:l}),I((T=m=function(t){function i(){for(var i,a=arguments.length,n=new Array(a),s=0;s<a;s++)n[s]=arguments[s];return i=t.call.apply(t,[this].concat(n))||this,e(r(i),"_poolMap",{}),e(r(i),"_datas",[]),e(r(i),"_tileIdxMap",{}),e(r(i),"_tileStateMap",{}),e(r(i),"_waitIdxs",new Map),e(r(i),"_helpArr",[]),e(r(i),"_FloorTypeIdx",new Map),e(r(i),"_FloorTypeProbs",new Map),e(r(i),"_FloorTypeCount",0),e(r(i),"_tileRectMap",{}),e(r(i),"_tileNodeMap",{}),e(r(i),"_gridTilesMap",{}),o(r(i),"itemRes",x,r(i)),i}a(i,t);var n=i.prototype;return n.newOne=function(t){var e=this._poolMap[t];e||(e=this._poolMap[t]=[]);var a=e.pop();a||(a=h(this._datas[t].item.node).getComponent(f));return delete a[i.IsInPool],a[i.ItemIdxTag]=t,a},n.deleteOne=function(t){var e=t[i.ItemIdxTag];if(null!=e){t[i.IsInPool]=!0;var a=this._poolMap[e];a&&(a=this._poolMap[e]=[]),a.push(t)}},n.start=function(){if(this._FloorTypeCount=Object.keys(c).length,this.itemRes){var t=0,e=[];this.itemRes.children.forEach((function(i){var a=i.getComponent(f);a&&a.node.active&&(e.push(a),t+=a.weight)}));for(var i=e.length,a=0;a<i;a++){var r=e[a],o=r.weight/t;this._datas.push({rate:o,item:r});var n=r.floorType,s=this._FloorTypeIdx.get(n);null==s&&(s=[],this._FloorTypeIdx.set(n,s),this._waitIdxs.set(n,[]),this._FloorTypeProbs.set(n,0)),this._FloorTypeProbs.set(n,this._FloorTypeProbs.get(n)+o),s.push(a)}}_.addListener("onTile",this.onTile,this),_.addListener("offTile",this.onOffTile,this)},n.onOffTile=function(t){var e=this,i=this._gridTilesMap[t.data];i&&(delete this._gridTilesMap[t.data],i.forEach((function(t){var i=e._tileNodeMap[t];i&&(i.node.parent&&i.node.parent.removeChild(i.node),e.deleteOne(i))})),i.length=0)},n.onTile=function(t){var e=this,i=t.data.tType,a=t.data.pos.x,r=t.data.pos.y,o=t.data.gPos,n=a+"_"+r;if(!this._tileNodeMap[n]){var s=0,l=null,p=this._tileIdxMap[n];if(null==p||isNaN(p)||-1==p){if(null!=p&&isNaN(p)||-1==p)return;var h=v.ItmeProbabilityMap.get(i);if(null==h||h<Math.random())return void(this._tileIdxMap[n]=-1);var d=this._helpArr;d.length=0;for(var _=!1;!_;)s=this.getOneItemIdx(i),(_=this.judgePlace(s,t.data.pos))||d.push(s);0!=d.length&&d.forEach((function(t){e.pushOneItemIdx(i,t)}))}else s=p,l=this._tileStateMap[n];var f=this.newOne(s),c=f.node;this.node.addChild(c);var I=c.getPosition();if(I.x=a,I.y=r,c.setPosition(I),!l){for(var g=this._datas[s].item.size,M=0;M<g.y;M++)for(var y=0;y<g.x;y++){var x=a+u.tileSize*y+"_"+(r+u.tileSize*M);this.tryClearTile(x),this._tileIdxMap[x]=NaN,this._tileRectMap[x]=n}var m=this._gridTilesMap[o];m||(m=this._gridTilesMap[o]=[]),m.push(n),this._tileNodeMap[n]=f,this._tileIdxMap[n]=s;var T=[];f.getState(T),this._tileStateMap[n]=T}f.randomState()}},n.tryClearTile=function(t){var e=this._tileRectMap[t];if(e){var i=this._tileNodeMap[e];if(i){delete this._tileNodeMap[e],i.node.parent&&i.node.parent.removeChild(i.node),this.deleteOne(i);for(var a=i.node.position.x,r=i.node.position.y,o=i.size,n=0;n<o.y;n++)for(var s=0;s<o.x;s++){var l=a+u.tileSize*s+"_"+(r+u.tileSize*n);this._tileIdxMap[l]=-1,delete this._tileRectMap[t]}}}},n.judgePlace=function(t,e){var i=this._datas[t].item.size;if(i.x<=1&&i.y<=1)return!0;for(var a=u.tileSize,r=i.x*i.y,o=0;o<i.y;o++)for(var n=0;n<i.x;n++){var s=e.x+n*a+"_"+(e.y+o*a),l=this._tileIdxMap[s];if(null!=l&&-1!=l){if(isNaN(l)){var p=this._tileRectMap[s];l=this._tileIdxMap[p]}if(!isNaN(l)){var h=this._datas[l].item.size;if(r<=h.x*h.y)return!1}}}return u.judgeArea(e,i)},n.getWaitCount=function(t){var e=this._waitIdxs.get(t);return e?e.length:0},n.getOneItemIdx=function(t){var e=this._waitIdxs.get(t).shift();return null==e&&(e=this.getRandomItemIdx(t)),e},n.pushOneItemIdx=function(t,e){this._waitIdxs.get(t).push(e)},n.getRandomItemIdx=function(t){var e=-1;if(!this._FloorTypeIdx.has(t)||!this._FloorTypeProbs.has(t))return e;for(var i=this._FloorTypeIdx.get(t),a=Math.random()*this._FloorTypeProbs.get(t),r=i.length,o=0,n=0;n<r;n++){var s=i[n];if((o+=this._datas[s].rate)>=a){e=s;break}}return e},i}(d),e(m,"help_v2",new p),e(m,"ItemIdxTag","__itemIdxTag__"),e(m,"IsInPool","__IsInPool__"),x=i((y=T).prototype,"itemRes",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),M=y))||M));n._RF.pop()}}}));

System.register("chunks:///_virtual/item.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./combin.ts"],(function(e){"use strict";var t,n,i,o,r,c,a,s,u,l,p;return{setters:[function(e){t=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.defineProperty,o=e.assertThisInitialized,r=e.initializerDefineProperty},function(e){c=e.cclegacy,a=e._decorator,s=e.Enum,u=e.Vec2,l=e.Component},function(e){p=e.Combin}],execute:function(){var f,h,b,m,y,g,d;e("FloorType",void 0),c._RF.push({},"0b97b7GnNBGO7IRkY4geoe0","item",void 0);var v,w=a.ccclass,z=a.property;!function(e){e[e.grass=0]="grass",e[e.beach=1]="beach"}(v||(v=e("FloorType",{}))),s(v);e("Item",(f=w("Item"),h=z({type:v}),f((y=t((m=function(e){function t(){for(var t,n=arguments.length,c=new Array(n),a=0;a<n;a++)c[a]=arguments[a];return t=e.call.apply(e,[this].concat(c))||this,i(o(t),"combins",[]),r(o(t),"size",y,o(t)),r(o(t),"floorType",g,o(t)),r(o(t),"weight",d,o(t)),t}n(t,e);var c=t.prototype;return c.onLoad=function(){this.combins=this.node.getComponentsInChildren(p).concat()},c.randomState=function(){this.combins.forEach((function(e,t){e&&e.random()}))},c.setState=function(e){this.combins.forEach((function(t,n){t&&(t.currIdx=e[n])}))},c.getState=function(e){e.length=0,this.combins.forEach((function(t,n){t&&e.push(t.currIdx)}))},t}(l)).prototype,"size",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new u(1,1)}}),g=t(m.prototype,"floorType",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return v.grass}}),d=t(m.prototype,"weight",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),b=m))||b));c._RF.pop()}}}));

System.register("chunks:///_virtual/wfcLoader.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var r,n,t,a,o;return{setters:[function(e){r=e.defineProperty,n=e.asyncToGenerator},function(e){t=e.cclegacy,a=e._decorator,o=e.SpriteFrame}],execute:function(){t._RF.push({},"1b3ado9Z/xMTrBK6sVflsaf","wfcLoader",void 0);a.ccclass,a.property;var s=e("WfcLoader",function(){function e(){}return e.xhrLoad=function(e,r){return new Promise((function(n,t){var a=new XMLHttpRequest;a.responseType=r,a.open("GET",e),a.send(),a.onreadystatechange=function(){4==a.readyState&&(200==a.status?n(a):t())}}))},e.getWFC=function(){var e=n(regeneratorRuntime.mark((function e(r){var n,t,a,s,c,u,i,f;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,t=r+"data.json",e.next=4,this.xhrLoad(t,"json");case 4:if(a=e.sent,s=a.response){e.next=9;break}return alert("没找到 "+t+"!"),e.abrupt("return",n);case 9:for(f in c=[],u={},i=function(e){var n=s.tiles[e],t=""+r+e+n[0],a=new Image;a.src=t,a.crossOrigin="";var i=new Promise((function(r,n){a.onload=function(){var n=o.createWithImage(a);u[e]=n,r(null)},a.onerror=n}));c.push(i)},s.tiles)i(f);return e.next=15,Promise.all(c);case 15:return n={config:s,imgs:u},e.abrupt("return",n);case 17:case"end":return e.stop()}}),e,this)})));return function(r){return e.apply(this,arguments)}}(),e}());r(s,"cacheMap",new Map),t._RF.pop()}}}));

System.register("chunks:///_virtual/touchMove.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var e,o,i,n,r,s,a,c,h,p,u,v;return{setters:[function(t){e=t.defineProperty,o=t.applyDecoratedDescriptor,i=t.inheritsLoose,n=t.initializerDefineProperty,r=t.assertThisInitialized},function(t){s=t.cclegacy,a=t._decorator,c=t.Node,h=t.Vec2,p=t.Vec3,u=t.SystemEventType,v=t.Component}],execute:function(){var d,l,m,f,M,y,S;s._RF.push({},"21e66PCUnxIuodOr/NUmNbi","touchMove",void 0);var _=a.ccclass,D=a.property;t("TouchMove",(d=_("TouchMove"),l=D({type:[c]}),d((S=y=function(t){function o(){for(var o,i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return o=t.call.apply(t,[this].concat(s))||this,n(r(o),"mapRoots",M,r(o)),e(r(o),"startPoint",new h),e(r(o),"startPos",new p),e(r(o),"moveDir",new h),e(r(o),"currMoveSpeed",10),e(r(o),"maxSpeed",1e3),e(r(o),"minSpeed",50),e(r(o),"dampingRate",.1),o}i(o,t);var s=o.prototype;return s.start=function(){this.node.on(u.TOUCH_START,this.onStart,this),this.node.on(u.TOUCH_MOVE,this.onMove,this),this.node.on(u.TOUCH_END,this.onEnd,this),this.node.on(u.TOUCH_CANCEL,(function(t){}))},s.update=function(t){this.damper(t),this.doMoveByDir(t)},s.onStart=function(t){var e=this;t.getLocation(this.startPoint),this.mapRoots.forEach((function(t){h.copy(e.startPos,t.position)})),this.moveDir.set(0,0)},s.onEnd=function(t){},s.onMove=function(t){var e=o.help_v2;t.getLocation(e),e.subtract(this.startPoint),e.length()<1||(h.copy(this.moveDir,e),this.moveDir.normalize())},s.doMoveByDir=function(t){if(0!=this.moveDir.lengthSqr()){var e=o.help_v2;h.multiplyScalar(e,this.moveDir,t*this.currMoveSpeed);var i=o.help_v3;i.set(e.x,e.y,0),this.mapRoots.forEach((function(t){var e=o.help_v3_1;h.add(e,i,t.position),t.setPosition(e)}))}},s.damper=function(t){this.currMoveSpeed-=this.dampingRate*this.currMoveSpeed,this.currMoveSpeed=Math.min(this.currMoveSpeed,this.maxSpeed),this.currMoveSpeed=Math.max(this.currMoveSpeed,this.minSpeed)},o}(v),e(y,"help_v2",new h),e(y,"help_v3",new p),e(y,"help_v3_1",new p),M=o((f=S).prototype,"mapRoots",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),m=f))||m));s._RF.pop()}}}));

System.register("chunks:///_virtual/grid.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./eventer.ts","./eventMgr.ts"],(function(t){"use strict";var e,i,o,n,r,a,s,l,c,h,f,p,u,v,g,d;return{setters:[function(t){e=t.defineProperty,i=t.inheritsLoose,o=t.assertThisInitialized,n=t.createClass},function(t){r=t.cclegacy,a=t._decorator,s=t.Vec3,l=t.Vec2,c=t.Node,h=t.Layers,f=t.Sprite,p=t.UITransform,u=t.Component},function(t){v=t.Eventer},function(t){g=t.baseEvent,d=t.EventMgr}],execute:function(){var _,y,w;t("GridState",void 0),r._RF.push({},"36a9bXXj2lDI6drNbWmMSQX","grid",void 0);var M,S=a.ccclass;a.property;!function(t){t[t.none=0]="none",t[t.collapseing=1]="collapseing",t[t.complete=2]="complete"}(M||(M=t("GridState",{})));t("Grid",S("Grid")((w=y=function(t){function r(){for(var i,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return i=t.call.apply(t,[this].concat(r))||this,e(o(i),"_GridPos",new l),e(o(i),"_sp",null),e(o(i),"_wfc",null),e(o(i),"_wfcSpMap",new Map),e(o(i),"_state",M.none),e(o(i),"_tileEvent",new g({pos:new l,tType:0,gPos:""})),e(o(i),"_offTileEvent",new g),i}i(r,t),r.poolNew=function(){var t=this._poolArr.pop();t?delete t[this.IN_POOL_TAG]:t=new c("grid").addComponent(r);return t},r.poolDelete=function(t){t&&!t[this.IN_POOL_TAG]&&this._poolArr.push(t)},r.getWFC=function(){for(var t,e=0,i=this._wfcPool.length;e<i;e++){var o=this._wfcPool[e];if(!o.isCollapseing){t=o,this._wfcPool.splice(e,1);break}}return t||(t=new WFC.WFC2D(r.wfcDataImg.config)),t},r.storeWFC=function(t){t&&this._wfcPool.push(t)},r.clear=function(){this.posDataMap.clear(),this.posDataMap.clear(),this._wfcPool.length=0,this._poolArr.length=0},r.setEventTile=function(t){this._TileEventMap=t},r.getTileByWPos=function(t){var e=null,i=Math.floor(t.x/r.gridSize),o=Math.floor(t.y/r.gridSize),n=i+"_"+o,a=this.posDataMap.get(n);if(!a)return e;var s=Math.floor((t.x-i*r.gridSize)/r.tileSize),l=Math.floor((t.y-o*r.gridSize)/r.tileSize),c=r.gridSize/r.tileSize;return e=a[s+c*(c-l-1)]},r.judgeArea=function(t,e){if(e.x<=1&&e.y<=1)return!0;for(var i=null,o=r.helpV2,n=0;n<e.y;n++)for(var a=0;a<e.x;a++){o.x=t.x+a*r.tileSize,o.y=t.y+n*r.tileSize;var s=this.getTileByWPos(o);if(null==s)return!1;var l;if(l=s[0],s[1],null!=i){if(i!=l)return!1}else i=l}return!0};var a=r.prototype;return a.start=function(){this.node.on;for(var t=r.tileSize,e=Math.floor(r.gridSize/t),i=0;i<e;i++)for(var o=0;o<e;o++){var n=o+"_"+i,a=new c(n);a.layer=h.Enum.UI_2D,a.parent=this.node,this.node.addChild(a),a.setPosition((o+.5)*t,(i+.5)*t);var s=a.addComponent(f);s.sizeMode=f.SizeMode.CUSTOM,this._wfcSpMap.set(n,s);var l=a.getComponent(p);l.width=t,l.height=t}},a.show=function(t){var e=this,i=this.getPosKey();if(r.posDataMap.get(i))this.refrashDisplay();else{var o,n;r.collapseingMap.set(i,!0);var a=Math.floor(r.gridSize/r.tileSize);null===(o=this.wfc)||void 0===o||o.clearKnown();var s=this.calcaknown(t),l=s&&s.length>0,c=this.calcaHornknown(t);l&&(a+=2,c=c.concat(s)),null===(n=this.wfc)||void 0===n||n.setKnown(c);try{var h;null===(h=this.wfc)||void 0===h||h.collapse(a,a,1e3).then((function(t){r.eventer.Emit(r.ON_COLLAPSED,i),r.collapseingMap.delete(i),t.length<1?console.error("collapse 计算的返回值为空"):i==e.getPosKey()&&(l&&e.cutData(t,a),r.posDataMap.set(i,t),e.refrashDisplay())})).catch((function(t){r.collapseingMap.delete(i),console.error(t)}))}catch(t){console.error(t)}}this._state},a.hide=function(){var t;this._wfcSpMap.forEach((function(t){t&&(t.node.active=!1)})),this._wfc&&(null===(t=this._wfc)||void 0===t?void 0:t.isCollapseing)&&(r.storeWFC(this._wfc),this._wfc=null);var e=this.getPosKey();this._offTileEvent.data=e,d.dispatchEvent("offTile",this._offTileEvent)},a.setGridPosition=function(t){var e=r.helpV3;e.set(t.x,t.y,0),e=e.multiplyScalar(r.gridSize),this.node.setPosition(e),this._GridPos.set(t.x,t.y)},a.getGridPosition=function(){return this._GridPos.clone()},a.hasData=function(){var t=this.getPosKey();return null!=r.posDataMap.get(t)},a.getPosKey=function(){var t=this._GridPos;return t.x+"_"+t.y},a.refrashDisplay=function(){var t=this.getPosKey();console.log("---- key : "+t);var e=r.posDataMap.get(t),i=this._wfcSpMap;if(e&&i)for(var o=Math.floor(r.gridSize/r.tileSize),n=0,a=e.length;n<a;n++){var l=n%o,c=Math.floor((a-1-n)/o),h=l+"_"+c,f=i.get(h);if(f){var p=e[n][0];f.node.active=!0,f.spriteFrame=r.wfcDataImg.imgs[p],f.node.eulerAngles;var u=r.helpV3;s.set(u,0,0,-90*e[n][1]),f.node.setRotationFromEuler(u),null!=r._TileEventMap[p]&&(this._tileEvent.data.tType=r._TileEventMap[p],this._tileEvent.data.pos.x=(l+this._GridPos.x*o)*r.tileSize,this._tileEvent.data.pos.y=(c+this._GridPos.y*o)*r.tileSize,this._tileEvent.data.gPos=h,d.dispatchEvent("onTile",this._tileEvent))}}},a.calcaHornknown=function(t){var e=[];if(!r.horn||r.horn.length<1)return e;var i,o,n=t,a=Math.floor(r.gridSize/r.tileSize);n&&n.length>0?(i=a+2-2,o=1):(o=0,i=a-1),e.push({x:o,y:o,tiles:r.horn}),e.push({x:i,y:o,tiles:r.horn}),e.push({x:i,y:i,tiles:r.horn}),e.push({x:o,y:i,tiles:r.horn});var s=a-2;if(s<1)return e;for(var l=0;l<s;l++)r.top&&e.push({x:o+1+l,y:o,tiles:r.top}),r.right&&e.push({x:i,y:o+1+l,tiles:r.right}),r.bottom&&e.push({x:o+1+l,y:i,tiles:r.bottom}),r.left&&e.push({x:o,y:o+1+l,tiles:r.left});return e},a.calcaknown=function(t){var e=this;if(!(t&&t.length>0))return null;var i=Math.floor(r.gridSize/r.tileSize),o=i+2,n=[];return null==t||t.forEach((function(t,a){var s,l,c=0,h=0,f=e.getGridPosition(),p=[],u=r.posDataMap;switch(t){case 0:if(h++,s=f.x+c+"_"+(f.y+h),l=u.get(s))for(var v=i-1,g=0;g<i;g++){var d=l[v*i+g];p.push({x:g+1,y:0,tiles:[[d[0],d[1]]]})}break;case 1:if(c++,s=f.x+c+"_"+(f.y+h),l=u.get(s))for(var _=o-1,y=0;y<i;y++){var w=l[y*i+0];p.push({x:_,y:y+1,tiles:[[w[0],w[1]]]})}break;case 2:if(h--,s=f.x+c+"_"+(f.y+h),l=u.get(s))for(var M=o-1,S=0;S<i;S++){var P=l[0*i+S];p.push({x:S+1,y:M,tiles:[[P[0],P[1]]]})}break;case 3:if(c--,s=f.x+c+"_"+(f.y+h),l=u.get(s))for(var x=i-1,z=0;z<i;z++){var E=l[z*i+x];p.push({x:0,y:z+1,tiles:[[E[0],E[1]]]})}}n=n.concat(p)})),n},a.cutData=function(t,e){var i=t.concat();t.length=0,i.forEach((function(i,o){var n=o%e,r=Math.floor(o/e);0<n&&n<e-1&&0<r&&r<e-1&&t.push(i)}))},n(r,[{key:"wfc",get:function(){return!this._wfc&&r.wfcDataImg&&(this._wfc=r.getWFC()),this._wfc}},{key:"state",get:function(){var t=this.getPosKey();return r.posDataMap.has(t)?M.complete:r.collapseingMap.has(t)?M.collapseing:M.none}}]),r}(u),e(y,"helpV3",new s),e(y,"helpV2",new l),e(y,"_poolArr",[]),e(y,"IN_POOL_TAG","__inPoolTag__"),e(y,"posDataMap",new Map),e(y,"collapseingMap",new Map),e(y,"_wfcPool",[]),e(y,"_TileEventMap",{}),e(y,"ON_COLLAPSED","ON_COLLAPSED"),e(y,"tileSize",50),e(y,"gridSize",100),e(y,"wfcDataImg",void 0),e(y,"eventer",new v),e(y,"horn",void 0),e(y,"top",void 0),e(y,"right",void 0),e(y,"bottom",void 0),e(y,"left",void 0),_=w))||_);r._RF.pop()}}}));

System.register("chunks:///_virtual/eventMgr.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./eventer.ts"],(function(e){"use strict";var n,t,i;return{setters:[function(e){n=e.defineProperty},function(e){t=e.cclegacy},function(e){i=e.Eventer}],execute:function(){t._RF.push({},"4a2f8VkQF5ENo+a0hcCkNPZ","eventMgr",void 0);var r=e("EventMgr",function(){function e(){}return e.addListener=function(e,n,t){this._eventHander.On(e,n,t)},e.dispatchEvent=function(e,n){this._eventHander.Emit(e,n)},e.removeListener=function(e,n,t){this._eventHander.RemoveListener(e,n,t)},e}());n(r,"_eventHander",new i);e("baseEvent",(function(e){void 0===e&&(e=null),n(this,"data",void 0),this.data=e})),e("EventTypes",(function(){n(this,"onTile",void 0),n(this,"offTile",void 0)}));t._RF.pop()}}}));

System.register("chunks:///_virtual/combin.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var r,e,n,i,o,c,s,a,u,l;return{setters:[function(t){r=t.applyDecoratedDescriptor,e=t.inheritsLoose,n=t.defineProperty,i=t.assertThisInitialized,o=t.initializerDefineProperty,c=t.createClass},function(t){s=t.cclegacy,a=t._decorator,u=t.Node,l=t.Component}],execute:function(){var p,d,f,h,y;s._RF.push({},"5632aynvt5AyJzOASk8mcVi","combin",void 0);var v=a.ccclass,m=a.property;t("Combin",(p=v("Combin"),d=m({type:[u]}),p((y=r((h=function(t){function r(){for(var r,e=arguments.length,c=new Array(e),s=0;s<e;s++)c[s]=arguments[s];return r=t.call.apply(t,[this].concat(c))||this,n(i(r),"_currIdx",0),o(i(r),"nodes",y,i(r)),r}e(r,t);var s=r.prototype;return s.start=function(){},s.random=function(){var t=this.nodes.length;this.currIdx=Math.floor(Math.random()*t)},c(r,[{key:"currIdx",get:function(){return this._currIdx},set:function(t){this._currIdx=t,this.nodes.forEach((function(t){return t.active=!1})),this.nodes[t].active=!0}}]),r}(l)).prototype,"nodes",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),f=h))||f));s._RF.pop()}}}));

System.register("chunks:///_virtual/eventer.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(e){"use strict";var t,n,r,s;return{setters:[function(e){t=e.createForOfIteratorHelperLoose,n=e.defineProperty},function(e){r=e.cclegacy,s=e._decorator}],execute:function(){r._RF.push({},"64082O/4ddDQqQMzjCRQqOg","eventer",void 0);s.ccclass,s.property,e("Eventer",function(){function e(){n(this,"events",{})}var r=e.prototype;return r.On=function(e,n,r){var s=this.events[e],i=null;if(s)for(var o,c=t(s);!(o=c()).done;){var u=o.value;if(u.func==n){i=u;break}}else s=this.events[e]=[];i?-1==i.thisArgs.lastIndexOf(r)&&i.thisArgs.push(r):s.push({func:n,thisArgs:[r]})},r.Emit=function(e){var n=this.events[e];if(n&&!(n.length<1)){for(var r=n.concat(),s=arguments.length,i=new Array(s>1?s-1:0),o=1;o<s;o++)i[o-1]=arguments[o];for(var c,u=t(r);!(c=u()).done;)for(var v,l=c.value,a=t(l.thisArgs);!(v=a()).done;){var f=v.value;l.func.apply(f,i)}r.length=0}},r.RemoveListener=function(e,t,n){var r=this.events[e];if(r)for(var s=0,i=r.length;s<i;++s)if(t==r[s].func){var o=r[s].thisArgs.lastIndexOf(n);if(-1!=o){r[s].thisArgs.splice(o,1),r[s].thisArgs.length<1&&r.splice(s,1),r.length<1&&delete this.events[e];break}}},r.RemoveListenerAll=function(){this.events={}},r.listenerCount=function(e){return this.events[e]?this.events[e].length:0},e}());r._RF.pop()}}}));

System.register("chunks:///_virtual/builder.ts.ts",["./_rollupPluginModLoBabelHelpers.js","cc"],(function(t){"use strict";var r,e,s,n;return{setters:[function(t){r=t.inheritsLoose},function(t){e=t.cclegacy,s=t._decorator,n=t.Component}],execute:function(){var o;e._RF.push({},"8a573GsqaJEK6UjF2zJfLzX","builder.ts",void 0);var u=s.ccclass;s.property,t("BuilderTs",u("BuilderTs")(o=function(t){function e(){return t.apply(this,arguments)||this}return r(e,t),e.prototype.start=function(){},e}(n))||o);e._RF.pop()}}}));

System.register("chunks:///_virtual/tileMap.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./grid.ts","./wfcLoader.ts","./appMain.ts"],(function(e){"use strict";var t,r,n,i,a,o,s,c,h,p,u,l,d,f,g,v,_,y,w;return{setters:[function(e){t=e.defineProperty,r=e.applyDecoratedDescriptor,n=e.inheritsLoose,i=e.assertThisInitialized,a=e.createClass,o=e.asyncToGenerator},function(e){s=e.cclegacy,c=e._decorator,h=e.Vec2,p=e.Rect,u=e.Director,l=e.Canvas,d=e.UITransform,f=e.Layers,g=e.Component},function(e){v=e.Grid,_=e.GridState},function(e){y=e.WfcLoader},function(e){w=e.AppMain}],execute:function(){var m,M,b,x;s._RF.push({},"d8fa778xQNEXrrJY2EvI4m1","tileMap",void 0);var k=c.ccclass,S=c.property;e("TileMap",k("TileMap")((x=b=function(e){function r(){for(var r,n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return r=e.call.apply(e,[this].concat(a))||this,t(i(r),"_gridSize",1e3),t(i(r),"grids",[]),t(i(r),"_canvas",null),t(i(r),"_gridMap",new Map),t(i(r),"_canRun",!1),t(i(r),"_OffsetList",[]),r}n(r,e);var s=r.prototype;return s.start=function(){var e=u.instance.getScene();this._canvas=null==e?void 0:e.getComponentInChildren(l)},s.update=function(e){this._canRun&&this.ckBorderOver()},s.clear=function(){this._canRun=!1,this._gridMap.forEach((function(e){null==e||e.hide(),e&&e.node.parent&&e.node.parent.removeChild(e.node),v.poolDelete(e)})),this._gridMap.clear(),v.clear()},s.setRes=function(){var e=o(regeneratorRuntime.mark((function e(t){var r,n,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._canRun){e.next=2;break}return e.abrupt("return");case 2:return n=(r=t).resName,i=w.CDNPath+"/res/samples/"+n+"/",e.next=7,y.getWFC(i);case 7:a=e.sent,v.gridSize=this._gridSize,v.tileSize=50,v.wfcDataImg=a,v.horn=r.horn,v.top=r.top,v.right=r.right,v.bottom=r.bottom,v.left=r.left,this._OffsetList.push(new h(0,1)),this._OffsetList.push(new h(1,0)),this._OffsetList.push(new h(0,-1)),this._OffsetList.push(new h(-1,0)),this._canRun=!0;case 21:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),s.ckBorderOver=function(){var e,t=r.helpRect,n=this.node.position,i=null===(e=this._canvas)||void 0===e?void 0:e.node.getComponent(d),a=.5*i.width,o=.5*i.height;t.set(-(n.x+a),-(n.y+o),i.width,i.height);var s=.5;t.width+=a*s,t.height+=o*s,t.x-=a*s,t.y-=o*s;var c=Math.floor(t.x/this._gridSize),p=Math.floor((t.x+t.width)/this._gridSize),u=Math.floor(t.y/this._gridSize),l=Math.floor((t.y+t.height)/this._gridSize),g=r.helpV2;g.x=p-c+1,g.y=l-u+1;var _=new Map,y=new Map;this._gridMap.forEach((function(e,t){y.set(t,!0)}));for(var w=0;w<g.x;w++)for(var m=0;m<g.y;m++){var M=w+c+"_"+(m+u);this._gridMap.has(M)?y.delete(M):_.set(M,!0)}for(var b=y.keys();;){var x=b.next();if(x.done)break;var k=this._gridMap.get(x.value);null==k||k.hide(),k&&k.node.parent&&k.node.parent.removeChild(k.node),v.poolDelete(k),this._gridMap.delete(x.value)}for(b=_.keys();;){var S=b.next();if(S.done)break;var C=v.poolNew();this.node.addChild(C.node),C.node.layer=f.Enum.UI_2D;var L=S.value.split("_");C.setGridPosition(new h(Number(L[0]),Number(L[1]))),this._gridMap.set(S.value,C)}_.size>0&&this.showGridpass()},s.showGridpass=function(){var e=this;this._gridMap.forEach(function(){var t=o(regeneratorRuntime.mark((function t(r){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=null,i=r.getPosKey(),r.hasData()){t.next=15;break}n=[],a=[];case 5:if(e.ckNeighbors(r,a,n),!(a.length<1)){t.next=9;break}return t.abrupt("break",15);case 9:return t.next=11,e.toWaitNeighbor(a);case 11:if(i==r.getPosKey()){t.next=13;break}return t.abrupt("break",15);case 13:t.next=5;break;case 15:r.show(n);case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())},s.ckNeighbors=function(e,t,r){t.length=0,r.length=0;for(var n=e.getGridPosition(),i=0;i<4;i++){var a=this._OffsetList[i],o=n.x+a.x+"_"+(n.y+a.y),s=this._gridMap.get(o);s&&(s.state==_.complete&&r.push(i),s.state==_.collapseing&&t.push(o))}},s.toWaitNeighbor=function(e){var t,r=new Promise((function(e){t=e})),n={};e.forEach((function(e){n[e]=!0}));var i={onCollapsed:function(e){delete n[e],Object.keys(n).length<1&&(v.eventer.RemoveListener(v.ON_COLLAPSED,i.onCollapsed,i),t())}};return v.eventer.On(v.ON_COLLAPSED,i.onCollapsed,i),r},a(r,[{key:"gridSize",get:function(){return this._gridSize},set:function(e){this._gridSize=e}}]),r}(g),t(b,"helpV2",new h),t(b,"helpRect",new p),r((M=x).prototype,"gridSize",[S],Object.getOwnPropertyDescriptor(M.prototype,"gridSize"),M.prototype),m=M))||m);s._RF.pop()}}}));

System.register("chunks:///_virtual/appMain.ts",["./_rollupPluginModLoBabelHelpers.js","cc","./grid.ts","./item.ts","./tileMap.ts"],(function(e){"use strict";var t,n,i,a,l,r,o,s,_;return{setters:[function(e){t=e.defineProperty,n=e.inheritsLoose,i=e.asyncToGenerator},function(e){a=e.cclegacy,l=e._decorator,r=e.Component},function(e){o=e.Grid},function(e){s=e.FloorType},function(e){_=e.TileMap}],execute:function(){var p,c,g;a._RF.push({},"ea491zJoLtLS5qTrFT7zU2L","appMain",void 0);var u=l.ccclass,v=(l.property,e("AppMain",u("AppMain")((g=c=function(e){function t(){return e.apply(this,arguments)||this}return n(t,e),t.prototype.start=function(){var e=i(regeneratorRuntime.mark((function e(){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=JSON.parse(t.Config),null==(i=this.node.scene.getComponentInChildren(_))||i.setRes(n),o.setEventTile({village_3_0:s.grass,village_17_4:s.beach}),t.ItmeProbabilityMap.set(s.grass,.4),t.ItmeProbabilityMap.set(s.beach,.5);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),t}(r),t(c,"ItmeProbabilityMap",new Map),t(c,"CDNPath","https://anseyuyin.github.io/wfc2D/"),t(c,"Config",'\n        { "resName": "Village", "horn": [\n            [\n                "village_3_0",\n                0\n            ]\n        ],\n        "top":[["village_3_0",0]],\n        "right":[["village_3_0",0], ["village_3_1",0],["village_5_1",0],["village_7_1",0], ["village_3_2",0],["village_5_2",0],["village_7_3",0]],\n        "bottom":[["village_3_0",0]],\n        "left":[["village_3_0",0], ["village_3_1",0],["village_5_1",0],["village_7_1",0], ["village_3_2",0],["village_5_2",0],["village_7_3",0]]\n    }\n    '),p=g))||p));window&&window.location&&-1==window.location.hostname.indexOf("github")&&(v.CDNPath="http://192.168.50.134:5500/"),a._RF.pop()}}}));

System.register("chunks:///_virtual/main",["./eventer.ts","./eventMgr.ts","./grid.ts","./combin.ts","./item.ts","./wfcLoader.ts","./tileMap.ts","./appMain.ts","./itemMap.ts","./touchMove.ts","./builder.ts.ts"],(function(){"use strict";return{setters:[null,null,null,null,null,null,null,null,null,null,null],execute:function(){}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///_virtual/main'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});